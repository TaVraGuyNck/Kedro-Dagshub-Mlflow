FROM mcr.microsoft.com/devcontainers/base:ubuntu

# Install dependencies for pyenv and Python build
RUN apt-get update && apt-get install -y \
    build-essential curl git libssl-dev zlib1g-dev \
    libbz2-dev libreadline-dev libsqlite3-dev wget llvm \
    libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev \
    libffi-dev liblzma-dev python3-pip && \
    rm -rf /var/lib/apt/lists/*

# Install pyenv
ENV PYENV_ROOT="/root/.pyenv"
ENV PATH="$PYENV_ROOT/bin:$PATH"
RUN curl https://pyenv.run | bash

# Install Python 3.9.13 and set as global version
RUN /bin/bash -c "source $PYENV_ROOT/bin/pyenv && \
    pyenv install 3.9.13 && \
    pyenv global 3.9.13"

# Ensure the PATH is set correctly
ENV PATH="$PYENV_ROOT/versions/3.9.13/bin:$PATH"

# Upgrade pip and install Jupyter kernel
RUN pip install --upgrade pip ipykernel
